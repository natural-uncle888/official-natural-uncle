<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æœ€æ–°æ¶ˆæ¯ï½œå…¬å‘Šç®¡ç†</title>
  <!-- Tailwind CDNï¼ˆé–‹ç™¼/å…§éƒ¨å·¥å…·å¯ç”¨ï¼›ä¸Šç·šè«‹æ”¹ç”¨ç·¨è­¯ç‰ˆï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    ul li { display: list-item; } /* ç¢ºä¿ bullets å¤šè¡Œé¡¯ç¤º */
    details[open] summary { margin-bottom: 0.5rem; }
    code { background: #f1f5f9; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-6xl mx-auto p-6 space-y-6">

    <h1 class="text-2xl font-bold mb-4">æœ€æ–°æ¶ˆæ¯ï½œå…¬å‘Šç®¡ç†å·¥å…·</h1>

    <!-- âœ… Action Bar -->
    <div class="flex flex-wrap gap-2 items-center mb-4">
      <button id="btn-load" class="px-4 py-2 rounded bg-slate-900 text-white hover:bg-slate-800">
        å¾ä¼ºæœå™¨è¼‰å…¥ /news.json
      </button>

      <label class="px-4 py-2 rounded bg-white border cursor-pointer hover:bg-slate-100">
        å¾æœ¬æ©ŸåŒ¯å…¥ JSON
        <input id="file-input" type="file" accept="application/json" class="hidden" />
      </label>

      <button id="btn-add" class="px-4 py-2 rounded bg-white border hover:bg-slate-100">
        æ–°å¢ä¸€ç­†
      </button>
      <button id="btn-download" class="px-4 py-2 rounded bg-white border hover:bg-slate-100">
        ä¸‹è¼‰ news.json
      </button>

      <button id="btn-upload-toggle" class="px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-500"
              aria-expanded="false" aria-controls="gh-panel">
        ä¸Šå‚³åˆ° GitHub
      </button>

      <span id="dirty-ind" class="ml-2 text-xs text-amber-600 hidden">æœ‰æœªå„²å­˜è®Šæ›´</span>
    </div>

    <!-- âœ… GitHub è¨­å®šå€ -->
    <div id="gh-panel" class="hidden p-4 bg-white rounded-xl border">
      <div class="flex items-center justify-between mb-3">
        <div class="text-base font-semibold">ä¸Šå‚³è¨­å®š</div>
        <button id="btn-upload-close" class="text-sm text-slate-500 hover:underline">éš±è—</button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
        <div>
          <label class="block text-sm font-medium mb-1">Owner</label>
          <input id="gh-owner" class="w-full border rounded px-2 py-1" placeholder="your-org-or-user">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Repo</label>
          <input id="gh-repo" class="w-full border rounded px-2 py-1" placeholder="your-repo">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Branch</label>
          <input id="gh-branch" class="w-full border rounded px-2 py-1" value="main">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Path</label>
          <input id="gh-path" class="w-full border rounded px-2 py-1" value="news.json">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">GitHub Token</label>
          <div class="relative">
            <input id="gh-token" type="password" class="w-full border rounded px-2 py-1 pr-10" placeholder="ghp_xxx">
            <button type="button" id="toggle-token"
                    class="absolute right-2 top-1/2 -translate-y-1/2 text-sm text-blue-600 hover:underline">é¡¯ç¤º</button>
          </div>
        </div>
      </div>
      <div class="mt-3 flex items-center gap-3">
        <label class="inline-flex items-center gap-2 text-sm">
          <input id="remember-settings" type="checkbox" class="border rounded"> è¨˜ä½è¨­å®šï¼ˆä¸å« Tokenï¼‰
        </label>
        <button id="btn-upload" class="px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-500">åŸ·è¡Œä¸Šå‚³</button>
        <span id="gh-status" class="text-sm text-slate-500"></span>
      </div>
    </div>
    <!-- âœ… ä½¿ç”¨æ•™å­¸é¢æ¿ -->
    <details id="guide-panel" class="p-4 bg-white rounded-xl border">
      <summary class="cursor-pointer text-base font-semibold text-blue-700">
        ğŸ“˜ ä½¿ç”¨èªªæ˜èˆ‡ HTML ç·¨è¼¯æ•™å­¸ï¼ˆé»æˆ‘å±•é–‹ï¼‰
      </summary>

      <div class="mt-4 space-y-6 text-sm leading-6 text-slate-700">
        <!-- Summary æ•™å­¸ -->
        <section>
          <h3 class="font-semibold text-slate-900 mb-1">â–¶ ä¸»å…§å®¹ Summary ä½¿ç”¨æ–¹å¼</h3>
          <p class="mb-2">ä¸»å…§å®¹å¯åˆ‡æ›<strong>[ç´”æ–‡å­—]</strong>æˆ–<strong>[HTML]</strong>æ¨¡å¼ï¼Œç”¨ä¾†å»ºç«‹æ®µè½ã€ç²—é«”ã€æ›è¡Œæˆ–é¡è‰²ã€‚</p>
          <div class="rounded border bg-slate-50 p-3 text-xs space-y-1">
            <div>ç¯„ä¾‹ï¼š</div>
            <div>&lt;b&gt;ç²—é«”æ–‡å­—&lt;/b&gt;</div>
            <div>&lt;i&gt;æ–œé«”æ–‡å­—&lt;/i&gt;</div>
            <div>&lt;u&gt;åº•ç·šæ–‡å­—&lt;/u&gt;</div>
            <div>&lt;br&gt; â† æ›è¡Œ</div>
            <div>&lt;span style="color:#e60000"&gt;ç´…è‰²æé†’æ–‡å­—&lt;/span&gt;</div>
            <div>&lt;span style="font-size:18px"&gt;æ”¾å¤§æ–‡å­— 18px&lt;/span&gt;</div>
            <div>&lt;span style="text-align:center;display:block"&gt;ç½®ä¸­å…§å®¹&lt;/span&gt;</div>
          </div>
        </section>

        <!-- Bullets æ•™å­¸ -->
        <section>
          <h3 class="font-semibold text-slate-900 mb-1">â–¶ å±•é–‹å…§å®¹ Bullets ä½¿ç”¨æ–¹å¼</h3>
          <p class="mb-2">æ¯è¡Œä»£è¡¨ä¸€å€‹é …ç›®åˆ—ï¼ˆæœƒè‡ªå‹•è®Šæˆã€Œâ€¢ã€ç¬¦è™Ÿï¼‰ã€‚ä¹Ÿæ”¯æ´ HTMLï¼</p>
          <div class="rounded border bg-slate-50 p-3 text-xs space-y-1">
            <div>ç¯„ä¾‹ï¼š</div>
            <div>&lt;b&gt;æ´»å‹•æ™‚é–“&lt;/b&gt;ï¼šå³æ—¥èµ·è‡³ 3/30</div>
            <div>&lt;span style="color:#16a34a"&gt;âœ… å…¨é¤¨å…é‹&lt;/span&gt;</div>
            <div>&lt;span style="color:#e11d48"&gt;âš  æ•¸é‡æœ‰é™ï¼Œå”®å®Œç‚ºæ­¢&lt;/span&gt;</div>
          </div>
        </section>

        <!-- è‰²ç¥¨ -->
        <section>
          <h3 class="font-semibold text-slate-900 mb-2">â–¶ å¸¸ç”¨é¡è‰²è¡¨ï¼ˆé»ä¸€ä¸‹è‡ªå‹•è¤‡è£½ HEX è‰²ç¢¼ï¼‰</h3>
          <details class="rounded border bg-slate-50">
            <summary class="cursor-pointer px-3 py-2">ğŸ¨ å±•é–‹è‰²ç¥¨</summary>
            <div class="p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 text-xs">
              <!-- è‰²ç¥¨æŒ‰éˆ• -->
              <button class="swatch border rounded overflow-hidden" data-hex="#000000">
                <div style="background:#000000;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Black</span><code>#000000</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#FFFFFF">
                <div style="background:#FFFFFF;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>White</span><code>#FFFFFF</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#EF4444">
                <div style="background:#EF4444;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Red</span><code>#EF4444</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#F97316">
                <div style="background:#F97316;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Orange</span><code>#F97316</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#F59E0B">
                <div style="background:#F59E0B;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Amber</span><code>#F59E0B</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#22C55E">
                <div style="background:#22C55E;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Green</span><code>#22C55E</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#3B82F6">
                <div style="background:#3B82F6;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Blue</span><code>#3B82F6</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#A855F7">
                <div style="background:#A855F7;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Purple</span><code>#A855F7</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#EC4899">
                <div style="background:#EC4899;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Pink</span><code>#EC4899</code></div>
              </button>
              <button class="swatch border rounded overflow-hidden" data-hex="#64748B">
                <div style="background:#64748B;height:28px;"></div>
                <div class="p-1 flex justify-between"><span>Slate</span><code>#64748B</code></div>
              </button>
            </div>
            <p class="text-slate-500 px-3 pb-2">æç¤ºï¼šå¯ç”¨æ–¼ <code>&lt;span style="color:HEX"&gt;</code></p>
          </details>
        </section>
      </div>
    </details>
    <!-- âœ… Items Container -->
    <div id="items" class="space-y-6"></div>

  </div> <!-- end wrapper -->

  <!-- âœ… å–®ç­† Item çš„æ¨¡æ¿ -->
  <template id="item-tpl">
    <div class="p-4 bg-white rounded-xl border shadow-sm">
      <div class="flex items-start justify-between">
        <h2 class="text-lg font-semibold">å…¬å‘Šé …ç›®</h2>
        <button class="btn-remove text-red-600 text-sm hover:underline">åˆªé™¤é€™ç­†</button>
      </div>

      <!-- âœ… åŸºæœ¬æ¬„ä½ -->
      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
        <div>
          <label class="block text-sm font-medium mb-1">IDï¼ˆå”¯ä¸€ï¼‰</label>
          <input class="f-id w-full border rounded px-2 py-1" placeholder="ann-20250101">
          <p class="text-xs text-slate-500">å°å¯«è‹±æ–‡ã€æ•¸å­—ã€- çµ„æˆ</p>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">é¡å‹ type</label>
          <select class="f-type w-full border rounded px-2 py-1">
            <option value="announce">announce</option>
            <option value="promo">promo</option>
          </select>
        </div>

        <div class="flex items-center gap-2 mt-6">
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" class="f-pinned"> <span class="text-sm">ç½®é ‚</span>
          </label>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Badge æ¨™ç±¤ï¼ˆå¯ç©ºï¼‰</label>
          <input class="f-badge w-full border rounded px-2 py-1" placeholder="HOT / NEW">
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">æ¨™é¡Œ title</label>
          <input class="f-title w-full border rounded px-2 py-1" placeholder="å…¬å‘Šæ¨™é¡Œ">
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Periodï¼ˆæ—¥æœŸé¡¯ç¤ºç”¨å­—ä¸²ï¼‰</label>
          <input class="f-period w-full border rounded px-2 py-1" placeholder="2025/02/01 - 2025/02/20">
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">é–‹å§‹æ—¥æœŸï¼ˆstartï¼‰</label>
          <input type="date" class="f-start w-full border rounded px-2 py-1">
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">çµæŸæ—¥æœŸï¼ˆendï¼‰</label>
          <input type="date" class="f-end w-full border rounded px-2 py-1">
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">å±•é–‹æŒ‰éˆ•æ–‡å­—</label>
          <input class="f-summary-btn w-full border rounded px-2 py-1" placeholder="æŸ¥çœ‹å…§å®¹">
        </div>
      </div>

      <!-- âœ… Summary + Bullets -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- âœ… Summary -->
        <div>
          <div class="flex items-center justify-between mb-1">
            <label class="block text-sm font-medium">ä¸»å…§å®¹ Summary</label>
            <select class="f-summary-format border rounded px-2 py-1 text-sm">
              <option value="text">ç´”æ–‡å­—</option>
              <option value="html">HTML æ ¼å¼</option>
            </select>
          </div>
          <textarea class="f-summary w-full border rounded px-2 py-2 h-28"
            placeholder="æ”¯æ´æ›è¡Œã€ç²—é«”ã€é¡è‰²..."></textarea>
        </div>

        <!-- âœ… Bulletsï¼ˆæ”¯æ´ HTMLï¼‰ -->
        <div>
          <label class="block text-sm font-medium mb-1">å±•é–‹å…§å®¹ Bulletsï¼ˆæ¯è¡Œä¸€é …ï¼‰</label>
          <textarea class="f-bullets w-full border rounded px-2 py-2 h-28"
            placeholder="æ¯ä¸€è¡Œæœƒæ˜¯ä¸€å€‹å°åœ“é»é …ç›®
æ”¯æ´ <b></b> <br> <span style='color:red'></span>"></textarea>
        </div>
      </div>

      <!-- âœ… CTA -->
      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">CTA é¡¯ç¤ºæ–‡å­—</label>
          <input class="f-cta-text w-full border rounded px-2 py-1" placeholder="äº†è§£æ›´å¤š">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1">CTA é€£çµç¶²å€</label>
          <input class="f-cta-href w-full border rounded px-2 py-1" placeholder="https://example.com">
        </div>
      </div>

      <!-- âœ… é è¦½ -->
      <div class="mt-6 border rounded p-4 bg-slate-50">
        <h3 class="text-sm text-slate-500 mb-2">é è¦½ï¼ˆå‰å°å‘ˆç¾æ–¹å¼æ¨¡æ“¬ï¼‰</h3>
        <div class="preview-card text-sm text-slate-800"></div>
      </div>
    </div>
  </template>
  <script>
    // -----------------------------
    // âœ… ç‹€æ…‹
    // -----------------------------
    let items = [];
    const elItems = document.getElementById('items');

    // -----------------------------
    // âœ… GitHub é¢æ¿é–‹é—œ
    // -----------------------------
    const ghPanel = document.getElementById('gh-panel');
    document.getElementById('btn-upload-toggle').addEventListener('click', () => {
      ghPanel.classList.toggle('hidden');
    });
    document.getElementById('btn-upload-close').addEventListener('click', () => {
      ghPanel.classList.add('hidden');
    });

    // -----------------------------
    // âœ… Utilityï¼šç”Ÿæˆ unique ID
    // -----------------------------
    function uid() {
      if (crypto?.randomUUID) return 'ann-' + crypto.randomUUID();
      return 'ann-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2, 7);
    }

    // -----------------------------
    // âœ… Utilityï¼šæ¨™è¨˜ dirty
    // -----------------------------
    function setDirty(v = true) {
      const ind = document.getElementById('dirty-ind');
      if (v) {
        ind.classList.remove('hidden');
        window.onbeforeunload = () => true;
      } else {
        ind.classList.add('hidden');
        window.onbeforeunload = null;
      }
    }

    // -----------------------------
    // âœ… HTML å®‰å…¨éæ¿¾ï¼ˆå…è¨±åŸºæœ¬æ¨™ç±¤ï¼‰
    // -----------------------------
    function sanitizeHTML(html) {
      const allowed = ['B','I','U','STRONG','EM','BR','SPAN'];
      const temp = document.createElement('div');
      temp.innerHTML = html;

      (function walk(node) {
        [...node.children].forEach(child => {
          if (!allowed.includes(child.tagName)) {
            child.replaceWith(...child.childNodes);
          } else if (child.tagName === 'SPAN') {
            let style = child.getAttribute('style') || '';
            child.removeAttribute('style');
            if (/color|font-size|text-align/.test(style)) {
              child.setAttribute('style', style);
            }
          }
          walk(child);
        });
      })(temp);
      return temp.innerHTML;
    }

    // -----------------------------
    // âœ… æ¸²æŸ“ Items
    // -----------------------------
    function renderItems() {
      elItems.innerHTML = '';
      items.forEach((item, idx) => {
        const tpl = document.getElementById('item-tpl');
        const node = tpl.content.cloneNode(true);
        const q = sel => node.querySelector(sel);

        q('.btn-remove').addEventListener('click', () => {
          if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™ï¼Ÿ')) {
            items.splice(idx, 1);
            renderItems();
            setDirty();
          }
        });

        // --- å¡«å…¥è³‡æ–™ ---
        q('.f-id').value = item.id;
        q('.f-type').value = item.type;
        q('.f-pinned').checked = item.pinned;
        q('.f-badge').value = item.badge || '';
        q('.f-title').value = item.title || '';
        q('.f-period').value = item.period || '';
        q('.f-start').value = item.startsAt || '';
        q('.f-end').value = item.endsAt || '';
        q('.f-summary-btn').value = item.summaryButtonText || '';
        q('.f-summary').value = item.summary || '';
        q('.f-summary-format').value = item.summaryFormat || 'text';
        q('.f-bullets').value = (item.bullets || []).join('\n');
        q('.f-cta-text').value = item.cta?.text || '';
        q('.f-cta-href').value = item.cta?.href || '';

        // --- ç¶å®šè¼¸å…¥äº‹ä»¶ ---
        q('.f-title').addEventListener('input', e => { item.title = e.target.value; setDirty(); renderPreview(node, item); });
        q('.f-summary').addEventListener('input', e => { item.summary = e.target.value; setDirty(); renderPreview(node, item); });
        q('.f-summary-format').addEventListener('change', e => { item.summaryFormat = e.target.value; setDirty(); renderPreview(node, item); });
        q('.f-bullets').addEventListener('input', e => {
          item.bullets = e.target.value.split('\n').filter(x => x.trim());
          setDirty(); renderPreview(node, item);
        });

        // --- æ’å…¥ DOM ---
        elItems.appendChild(node);
        renderPreview(elItems.lastElementChild, item);
      });
    }
    // -----------------------------
    // âœ… é è¦½å¡ç‰‡æ¸²æŸ“
    // -----------------------------
    function renderPreview(el, item) {
      const container = el.querySelector('.preview-card');
      if (!container) return;

      const summary =
        item.summaryFormat === 'html'
          ? sanitizeHTML(item.summary || '')
          : (item.summary || '').replace(/\n/g, '<br>');

      const bullets =
        item.bullets?.length
          ? `<ul class="list-disc pl-4 space-y-1 [&>li]:block">
              ${item.bullets.map(b => `<li>${sanitizeHTML(b)}</li>`).join('')}
            </ul>`
          : '';

      container.innerHTML = `
        <article class="space-y-2">
          <h4 class="font-bold">${item.title || ''}</h4>
          <div class="text-slate-600">${summary}</div>
          ${bullets}
          ${item.cta?.href ? `<a href="${item.cta.href}" target="_blank" class="text-blue-600 underline">${item.cta.text || 'äº†è§£æ›´å¤š'}</a>` : ''}
        </article>`;
    }

    // -----------------------------
    // âœ… è¼‰å…¥ news.jsonï¼ˆä¿æŒåŸåŠŸèƒ½ï¼‰
    // -----------------------------
    document.getElementById('btn-load').addEventListener('click', async () => {
      try {
        const res = await fetch('news.json?ts=' + Date.now());
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error('JSON å¿…é ˆæ˜¯é™£åˆ—');
        items = data;
        renderItems();
        setDirty(false);
      } catch (err) {
        alert('è¼‰å…¥å¤±æ•—ï¼š' + err.message);
      }
    });

    // -----------------------------
    // âœ… åŒ¯å…¥ JSON
    // -----------------------------
    document.getElementById('file-input').addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;
      try {
        const text = await file.text();
        items = JSON.parse(text);
        renderItems();
        setDirty();
      } catch (err) {
        alert('åŒ¯å…¥å¤±æ•—ï¼š' + err.message);
      }
      e.target.value = '';
    });

    // -----------------------------
    // âœ… ä¸‹è¼‰ JSON
    // -----------------------------
    document.getElementById('btn-download').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(items, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'news.json';
      a.click();
      URL.revokeObjectURL(url);
      setDirty(false);
    });

    // -----------------------------
    // âœ… è‰²ç¥¨é»æ“Šè¤‡è£½ HEX
    // -----------------------------
    document.addEventListener('click', async e => {
      const sw = e.target.closest('.swatch');
      if (!sw) return;
      const hex = sw.dataset.hex;
      if (!hex) return;
      try {
        await navigator.clipboard.writeText(hex);
        sw.querySelector('code').textContent = 'Copied!';
        setTimeout(() => sw.querySelector('code').textContent = hex, 800);
      } catch {
        alert('ç„¡æ³•è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½: ' + hex);
      }
    });

    // -----------------------------
    // âœ… æ–°å¢ä¸€ç­†
    // -----------------------------
    document.getElementById('btn-add').addEventListener('click', () => {
      items.unshift({
        id: uid(),
        type: 'announce',
        pinned: false,
        badge: '',
        title: '',
        period: '',
        startsAt: '',
        endsAt: '',
        summaryFormat: 'text',
        summary: '',
        bullets: [],
        cta: { text: '', href: '' }
      });
      renderItems();
      setDirty();
    });

    // -----------------------------
    // âœ… GitHub ä¸Šå‚³åŠŸèƒ½
    // -----------------------------
    async function githubRequest(path, method = 'GET', body) {
      const token = document.getElementById('gh-token').value;
      return await fetch(`https://api.github.com${path}`, {
        method,
        headers: {
          'Accept': 'application/vnd.github+json',
          'Authorization': `Bearer ${token}`
        },
        body: body ? JSON.stringify(body) : undefined
      }).then(r => r.json());
    }

    document.getElementById('btn-upload').addEventListener('click', async () => {
      try {
        const owner = document.getElementById('gh-owner').value;
        const repo = document.getElementById('gh-repo').value;
        const branch = document.getElementById('gh-branch').value;
        const path = document.getElementById('gh-path').value;
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(items, null, 2))));
        await githubRequest(`/repos/${owner}/${repo}/contents/${path}`, 'PUT', {
          message: 'Update news.json',
          content,
          branch
        });
        alert('âœ… ä¸Šå‚³æˆåŠŸ');
        setDirty(false);
      } catch (err) {
        alert('âŒ ä¸Šå‚³å¤±æ•—ï¼š' + err.message);
      }
    });

    // åˆå§‹åŒ–æ¸²æŸ“
    renderItems();
  </script>
</body>
</html>
